---
- name: Apply CIS Benchmarks (Hardening)
  hosts: all
  become: true
  vars:
    # ---------------------------------------
    # SAFETY VARIABLES (DO NOT SKIP THESE)
    # ---------------------------------------

    # Don't perform the changes yet, just tell me what IS wrong
    rhel9cis_audit_only: false  # Set to 'true' first to just test!

    # DISABLE BOOTLOADER PASSWORD (Fixes the error)
    rhel9cis_set_boot_pass: false

    # Do not disable SSH (Or you lose access!)
    rhel9cis_ssh_disable_root_login: false
    rhel9cis_sshd_permit_root_login: "yes" 

    # Keep your current partition layout (CIS wants separate /tmp, /var partitions)
    rhel9cis_skip_filesystem_facts: true

    # 3. *** THE NEW FIX *** (Give your profile a real name)
    rhel9cis_authselect_custom_profile_name: "custom_security_profile"

    # Don't break your K3s/AWX networking
    rhel9cis_firewall_flush: false

  roles:
    - role: rhel9_cis
